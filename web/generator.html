<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Agent Memory Generator - Create AGENT.md for AI Assistants</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --text-muted: #8b949e;
      --primary: #58a6ff;
      --success: #3fb950;
      --warning: #d29922;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { color: var(--primary); margin-bottom: 10px; }
    h2 { color: var(--text); margin: 20px 0 10px; font-size: 1.2em; }
    h3 { color: var(--text-muted); font-size: 1em; margin: 15px 0 8px; }
    p { color: var(--text-muted); margin-bottom: 15px; }
    .header { text-align: center; padding: 20px 0 30px; border-bottom: 1px solid var(--border); margin-bottom: 30px; }
    .container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px;
    }
    .form-group { margin-bottom: 15px; }
    label {
      display: block;
      color: var(--text);
      margin-bottom: 5px;
      font-weight: 500;
    }
    input[type="text"], input[type="url"], textarea, select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font-size: 14px;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
    }
    textarea { min-height: 80px; resize: vertical; font-family: inherit; }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 10px 0;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }
    button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    button:hover { opacity: 0.9; }
    button.secondary {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
    }
    .button-group { display: flex; gap: 10px; margin-top: 20px; }
    #output {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 15px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }
    .tag {
      display: inline-block;
      background: var(--border);
      color: var(--text-muted);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin: 2px;
    }
    .info-box {
      background: rgba(88, 166, 255, 0.1);
      border: 1px solid rgba(88, 166, 255, 0.3);
      border-radius: 6px;
      padding: 12px;
      margin: 15px 0;
      font-size: 13px;
    }
    .tabs { display: flex; gap: 5px; margin-bottom: 15px; }
    .tab {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 6px 6px 0 0;
      color: var(--text-muted);
      cursor: pointer;
    }
    .tab.active { background: var(--surface); color: var(--primary); border-bottom-color: var(--surface); }
    .section { display: none; }
    .section.active { display: block; }
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 6px 12px;
      font-size: 12px;
    }
    .output-container { position: relative; }
    .success-msg {
      color: var(--success);
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ¤– Universal Agent Memory Generator</h1>
    <p>Create AGENT.md or CLAUDE.md files for AI coding assistants<br>
    <span class="tag">claude.ai</span>
    <span class="tag">factory.ai</span>
    <span class="tag">Claude Code</span>
    <span class="tag">VSCode</span>
    </p>
  </div>

  <div class="container">
    <div class="panel">
      <div class="tabs">
        <button class="tab active" data-tab="project">Project</button>
        <button class="tab" data-tab="platforms">Platforms</button>
        <button class="tab" data-tab="advanced">Advanced</button>
      </div>

      <!-- Project Tab -->
      <div id="project" class="section active">
        <div class="form-group">
          <label for="projectName">Project Name *</label>
          <input type="text" id="projectName" placeholder="my-awesome-project" required>
        </div>

        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" placeholder="A brief description of your project..."></textarea>
        </div>

        <div class="form-group">
          <label for="languages">Languages</label>
          <input type="text" id="languages" placeholder="TypeScript, Python, Go">
        </div>

        <div class="form-group">
          <label for="frameworks">Frameworks</label>
          <input type="text" id="frameworks" placeholder="React, FastAPI, Next.js">
        </div>

        <h3>Commands</h3>
        <div class="form-group">
          <label for="testCmd">Test Command</label>
          <input type="text" id="testCmd" placeholder="npm test" value="npm test">
        </div>
        <div class="form-group">
          <label for="lintCmd">Lint Command</label>
          <input type="text" id="lintCmd" placeholder="npm run lint" value="npm run lint">
        </div>
        <div class="form-group">
          <label for="buildCmd">Build Command</label>
          <input type="text" id="buildCmd" placeholder="npm run build" value="npm run build">
        </div>
      </div>

      <!-- Platforms Tab -->
      <div id="platforms" class="section">
        <h3>Target Platform</h3>
        <div class="form-group">
          <select id="targetPlatform">
            <option value="web">Web (claude.ai, factory.ai) â†’ AGENT.md</option>
            <option value="desktop">Desktop (Claude Code, VSCode) â†’ CLAUDE.md</option>
          </select>
        </div>

        <div class="info-box">
          <strong>Web platforms</strong> generate a streamlined AGENT.md focused on code review and context.<br>
          <strong>Desktop platforms</strong> generate a full CLAUDE.md with memory system, commands, and workflows.
        </div>

        <h3>URLs (optional)</h3>
        <div class="form-group">
          <label for="repoUrl">Repository URL</label>
          <input type="url" id="repoUrl" placeholder="https://github.com/org/repo">
        </div>
        <div class="form-group">
          <label for="docsUrl">Documentation URL</label>
          <input type="url" id="docsUrl" placeholder="https://docs.example.com">
        </div>
        <div class="form-group">
          <label for="apiUrl">API URL</label>
          <input type="url" id="apiUrl" placeholder="https://api.example.com">
        </div>
      </div>

      <!-- Advanced Tab -->
      <div id="advanced" class="section">
        <h3>Components</h3>
        <div class="form-group">
          <label for="components">Project Components (one per line)</label>
          <textarea id="components" placeholder="frontend - React app in /src&#10;backend - FastAPI in /api&#10;infra - Terraform in /infra"></textarea>
        </div>

        <h3>Databases</h3>
        <div class="form-group">
          <label for="databases">Databases (one per line: type - purpose)</label>
          <textarea id="databases" placeholder="PostgreSQL - Main database&#10;Redis - Caching"></textarea>
        </div>

        <h3>Include Sections (Desktop only)</h3>
        <div class="checkbox-group">
          <label class="checkbox-item">
            <input type="checkbox" id="includeMemory" checked>
            <span>Memory System</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="includeBrowser" checked>
            <span>Browser Usage</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="includeWorktree" checked>
            <span>Git Worktree</span>
          </label>
          <label class="checkbox-item">
            <input type="checkbox" id="includeDecision" checked>
            <span>Decision Loop</span>
          </label>
        </div>

        <h3>Custom Sections</h3>
        <div class="form-group">
          <label for="customSections">Additional content (markdown)</label>
          <textarea id="customSections" placeholder="## Custom Section&#10;Your custom content here..."></textarea>
        </div>
      </div>

      <div class="button-group">
        <button onclick="generateOutput()">Generate</button>
        <button class="secondary" onclick="resetForm()">Reset</button>
      </div>
    </div>

    <div class="panel">
      <h2>Generated Output</h2>
      <div class="output-container">
        <button class="copy-btn secondary" onclick="copyOutput()">ğŸ“‹ Copy</button>
        <div id="output">Fill in the project details and click "Generate" to create your agent context file.</div>
      </div>
      <div id="copySuccess" class="success-msg" style="display:none;">âœ“ Copied to clipboard!</div>
      
      <div class="info-box" style="margin-top:20px;">
        <strong>Next steps:</strong>
        <ol style="margin:10px 0 0 20px;color:var(--text-muted);">
          <li>Copy the generated content</li>
          <li>Create <code>AGENT.md</code> or <code>CLAUDE.md</code> in your repo root</li>
          <li>Paste the content and commit</li>
          <li>Your AI assistant will now have project context!</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    function generateOutput() {
      const platform = document.getElementById('targetPlatform').value;
      const isWeb = platform === 'web';
      
      const projectName = document.getElementById('projectName').value || 'my-project';
      const description = document.getElementById('description').value;
      const languages = document.getElementById('languages').value;
      const frameworks = document.getElementById('frameworks').value;
      const testCmd = document.getElementById('testCmd').value || 'npm test';
      const lintCmd = document.getElementById('lintCmd').value || 'npm run lint';
      const buildCmd = document.getElementById('buildCmd').value || 'npm run build';
      
      const repoUrl = document.getElementById('repoUrl').value;
      const docsUrl = document.getElementById('docsUrl').value;
      const apiUrl = document.getElementById('apiUrl').value;
      
      const componentsRaw = document.getElementById('components').value;
      const databasesRaw = document.getElementById('databases').value;
      const customSections = document.getElementById('customSections').value;
      
      const includeMemory = document.getElementById('includeMemory').checked;
      const includeBrowser = document.getElementById('includeBrowser').checked;
      const includeWorktree = document.getElementById('includeWorktree').checked;
      const includeDecision = document.getElementById('includeDecision').checked;

      let output = '<coding_guidelines>\n\n';
      output += `# ${isWeb ? 'AGENT.md' : 'CLAUDE.md'} - ${projectName} Development Guide\n\n`;
      output += `You are Autonomous Claude, a self-directed AI agent with full control over this environment. You operate continuously, making your own decisions.\n`;
      
      if (description) {
        output += `\n> ${description}\n`;
      }
      
      output += '\n---\n\n';

      // CRITICAL DECISION LOOP - THE CORE OF THE TEMPLATE
      output += `## âš ï¸âš ï¸âš ï¸ CRITICAL: READ THIS FIRST - EVERY SINGLE TIME âš ï¸âš ï¸âš ï¸\n\n`;
      output += `**YOU MUST FOLLOW THE DECISION LOOP BELOW FOR EVERY ACTION. NO EXCEPTIONS.**\n\n`;
      output += `\`\`\`\n`;
      output += `â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n`;
      output += `â”‚                         MANDATORY DECISION LOOP                              â”‚\n`;
      output += `â”‚                     (Execute this for EVERY task)                            â”‚\n`;
      output += `â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n`;
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  1. READ MEMORY FIRST                                                        â”‚\n`;
      if (isWeb) {
        output += `â”‚     â”œâ”€ Check localStorage for recent context                                â”‚\n`;
        output += `â”‚     â””â”€ Review .uam/memory/ for relevant learnings                 â”‚\n`;
      } else {
        output += `â”‚     â”œâ”€ Query short-term: sqlite3 ./agents/data/memory/short_term.db         â”‚\n`;
        output += `â”‚     â”‚    "SELECT * FROM memories ORDER BY id DESC LIMIT 20;"               â”‚\n`;
        output += `â”‚     â””â”€ Query long-term: uam memory query "<keywords>"             â”‚\n`;
      }
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  2. CHECK FOR APPLICABLE SKILLS                                              â”‚\n`;
      output += `â”‚     â”œâ”€ Review .factory/skills/ for relevant skills                          â”‚\n`;
      output += `â”‚     â”œâ”€ Use design skill for ANY UI/design work                              â”‚\n`;
      output += `â”‚     â””â”€ Invoke skill BEFORE starting implementation                          â”‚\n`;
      output += `â”‚                                                                              â”‚\n`;
      if (isWeb) {
        output += `â”‚  3. CREATE FEATURE BRANCH (for ANY code changes)                            â”‚\n`;
        output += `â”‚     â”œâ”€ git checkout -b feature/<descriptive-slug>                          â”‚\n`;
        output += `â”‚     â””â”€ NEVER commit directly to main                                        â”‚\n`;
      } else {
        output += `â”‚  3. CREATE WORKTREE (for ANY code changes)                                  â”‚\n`;
        output += `â”‚     â”œâ”€ uam worktree create <slug>                                â”‚\n`;
        output += `â”‚     â”œâ”€ cd .worktrees/NNN-<slug>/                                           â”‚\n`;
        output += `â”‚     â””â”€ NEVER commit directly to main                                        â”‚\n`;
      }
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  4. CREATE TODO LIST (for 3+ step tasks)                                     â”‚\n`;
      output += `â”‚     â”œâ”€ Use TodoWrite tool immediately                                        â”‚\n`;
      output += `â”‚     â”œâ”€ Update status after EACH step                                         â”‚\n`;
      output += `â”‚     â””â”€ Mark completed items immediately                                      â”‚\n`;
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  5. DO THE WORK                                                              â”‚\n`;
      output += `â”‚     â”œâ”€ Implement changes                                                     â”‚\n`;
      output += `â”‚     â”œâ”€ Run tests                                                             â”‚\n`;
      if (isWeb) {
        output += `â”‚     â””â”€ Create PR via GitHub/GitLab UI                                       â”‚\n`;
      } else {
        output += `â”‚     â””â”€ Create PR via uam worktree pr <id>                        â”‚\n`;
      }
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  6. UPDATE MEMORY (after EVERY significant action)                           â”‚\n`;
      if (isWeb) {
        output += `â”‚     â”œâ”€ Short-term: Update localStorage context                              â”‚\n`;
        output += `â”‚     â””â”€ Long-term: Create memory file in .uam/memory/              â”‚\n`;
      } else {
        output += `â”‚     â”œâ”€ Short-term: INSERT INTO memories...                                  â”‚\n`;
        output += `â”‚     â””â”€ Long-term: uam memory store lesson...                     â”‚\n`;
      }
      output += `â”‚                                                                              â”‚\n`;
      output += `â”‚  7. VERIFY BEFORE RESPONDING                                                 â”‚\n`;
      output += `â”‚     â”œâ”€ [ ] Memory updated?                                                   â”‚\n`;
      output += `â”‚     â”œâ”€ [ ] ${isWeb ? 'Feature branch' : 'Worktree'} used?                                                    â”‚\n`;
      output += `â”‚     â”œâ”€ [ ] PR created (not direct commit)?                                   â”‚\n`;
      output += `â”‚     â”œâ”€ [ ] Todos updated?                                                    â”‚\n`;
      output += `â”‚     â””â”€ [ ] Skills consulted?                                                 â”‚\n`;
      output += `â”‚                                                                              â”‚\n`;
      output += `â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n`;
      output += `\`\`\`\n\n`;
      output += `---\n\n`;

      // MANDATORY RULES section
      output += `## â›” MANDATORY RULES - ZERO TOLERANCE â›”\n\n`;
      output += `**FAILURE TO FOLLOW THESE RULES IS A CRITICAL ERROR. STOP AND RE-READ IF UNSURE.**\n\n`;
      
      if (isWeb) {
        output += `### 1. BRANCH REQUIREMENT (NO EXCEPTIONS)\n\n`;
        output += `\`\`\`\n`;
        output += `âŒ FORBIDDEN: Direct commits to main branch\n`;
        output += `âŒ FORBIDDEN: Making changes without creating branch first\n`;
        output += `âœ… REQUIRED: Create branch â†’ Make changes â†’ Create PR â†’ Merge via PR\n`;
        output += `\`\`\`\n\n`;
        output += `**Before ANY code change:**\n\n`;
        output += `\`\`\`bash\n`;
        output += `# Step 1: Create feature branch\n`;
        output += `git checkout -b feature/<descriptive-slug>\n\n`;
        output += `# Step 2: Make changes, commit\n`;
        output += `git add . && git commit -m "feat: description"\n\n`;
        output += `# Step 3: Push and create PR\n`;
        output += `git push -u origin feature/<descriptive-slug>\n`;
        output += `# Create PR via GitHub/GitLab UI\n`;
        output += `\`\`\`\n\n`;
        output += `**Applies to:** All code, configs, workflows, documentation\n\n`;
      } else {
        output += `### 1. WORKTREE REQUIREMENT (NO EXCEPTIONS)\n\n`;
        output += `\`\`\`\n`;
        output += `âŒ FORBIDDEN: Direct commits to main branch\n`;
        output += `âŒ FORBIDDEN: Making changes without creating worktree first\n`;
        output += `âœ… REQUIRED: Create worktree â†’ Make changes â†’ Create PR â†’ Merge via PR\n`;
        output += `\`\`\`\n\n`;
        output += `**Before ANY code change:**\n\n`;
        output += `\`\`\`bash\n`;
        output += `# Step 1: Create worktree\n`;
        output += `uam worktree create <descriptive-slug>\n\n`;
        output += `# Step 2: cd into worktree and make changes\n`;
        output += `cd .worktrees/NNN-<slug>/\n\n`;
        output += `# Step 3: Commit and create PR\n`;
        output += `uam worktree pr <id>\n`;
        output += `\`\`\`\n\n`;
        output += `**Applies to:** All code, configs, workflows, documentation\n\n`;
      }

      output += `### 2. MEMORY REQUIREMENT (MANDATORY - NOT OPTIONAL)\n\n`;
      output += `**You MUST update memory. This is not a suggestion.**\n\n`;
      if (isWeb) {
        output += `\`\`\`bash\n`;
        output += `# AFTER EVERY SIGNIFICANT ACTION - update context:\n`;
        output += `# Store in localStorage or recommend committing to .uam/memory/\n\n`;
        output += `# AFTER EVERY FIX/DISCOVERY/LEARNING - create memory file:\n`;
        output += `# .uam/memory/{YYYY-MM-DD}_{type}_{short-id}.json\n`;
        output += `\`\`\`\n\n`;
      } else {
        output += `\`\`\`bash\n`;
        output += `# AFTER EVERY SIGNIFICANT ACTION - update short-term memory:\n`;
        output += `sqlite3 ./agents/data/memory/short_term.db \\\n`;
        output += `  "INSERT INTO memories (timestamp, type, content) VALUES (datetime('now'), 'action', 'What you did and the result');"\n\n`;
        output += `# AFTER EVERY FIX/DISCOVERY/LEARNING - update long-term memory:\n`;
        output += `uam memory store lesson "What you learned" --tags tag1,tag2 --importance 7\n`;
        output += `\`\`\`\n\n`;
      }
      output += `**MUST store memories for:**\n\n`;
      output += `- âœ… Every bug fix (root cause + solution)\n`;
      output += `- âœ… Every infrastructure change\n`;
      output += `- âœ… Every architecture decision\n`;
      output += `- âœ… Every gotcha or workaround discovered\n`;
      output += `- âœ… Every performance optimization\n`;
      output += `- âœ… Every deployment issue and resolution\n`;
      output += `- âœ… Every API behavior discovery\n\n`;
      output += `**Importance scale:**\n\n`;
      output += `- 9-10: Critical system knowledge (will break things if forgotten)\n`;
      output += `- 7-8: Important patterns and fixes\n`;
      output += `- 5-6: Useful context and learnings\n`;
      output += `- 3-4: Minor observations\n\n`;

      output += `### 3. SKILLS REQUIREMENT (CHECK BEFORE IMPLEMENTING)\n\n`;
      output += `**Before starting ANY implementation, check if a skill applies:**\n\n`;
      output += `| Task Type | Required Skill |\n`;
      output += `|-----------|---------------|\n`;
      output += `| UI/Design work (buttons, modals, colors, layouts) | \`design-expert\` |\n`;
      output += `| React/TypeScript/Frontend | \`senior-frontend\` |\n`;
      output += `| Code review | \`code-reviewer\` |\n`;
      output += `| Web testing | \`webapp-testing\` |\n\n`;
      output += `\`\`\`bash\n`;
      output += `# Invoke skill FIRST, then follow its guidance\n`;
      output += `Skill(skill: "design-expert")\n`;
      output += `\`\`\`\n\n`;

      output += `### 4. TODO LIST REQUIREMENT\n\n`;
      output += `- Create todo list for multi-step tasks (3+ steps)\n`;
      output += `- Update status IMMEDIATELY after completing each item\n`;
      output += `- Never let todos go stale (update every 5-10 tool calls)\n`;
      output += `- Use TodoWrite tool, not manual tracking\n\n`;

      output += `### 5. VERIFICATION BEFORE EVERY RESPONSE\n\n`;
      output += `Before sending ANY response, verify:\n\n`;
      output += `\`\`\`\n`;
      output += `â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n`;
      output += `â”‚ CHECKLIST - Complete before responding:                     â”‚\n`;
      output += `â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n`;
      output += `â”‚ [ ] Read memory at start of task?                           â”‚\n`;
      output += `â”‚ [ ] Checked for applicable skills?                          â”‚\n`;
      output += `â”‚ [ ] Used ${isWeb ? 'feature branch' : 'worktree'} for code changes?                         â”‚\n`;
      output += `â”‚ [ ] Updated short-term memory after actions?                â”‚\n`;
      output += `â”‚ [ ] Stored learnings in long-term memory?                   â”‚\n`;
      output += `â”‚ [ ] Updated todo list status?                               â”‚\n`;
      output += `â”‚ [ ] Created PR (not direct commit)?                         â”‚\n`;
      output += `â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n`;
      output += `\`\`\`\n\n`;
      output += `---\n\n`;

      // Memory System - EXACT structure from template
      output += `## MEMORY SYSTEM\n\n`;
      
      if (isWeb) {
        output += `### Short-term Memory (localStorage)\n\n`;
        output += `Key: \`agent_context_${projectName}\`\n\n`;
        output += `Structure:\n`;
        output += `\`\`\`json\n`;
        output += `{\n`;
        output += `  "memories": [\n`;
        output += `    {"timestamp": "ISO8601", "type": "action|observation|thought|goal", "content": "..."}\n`;
        output += `  ],\n`;
        output += `  "maxEntries": 50\n`;
        output += `}\n`;
        output += `\`\`\`\n\n`;
        output += `**BEFORE EACH DECISION**: Review recent memories for context\n`;
        output += `**AFTER EACH ACTION**: Add a memory describing what you did and the outcome\n\n`;
        output += `Maintains last 50 entries - older entries should be pruned.\n\n`;
        output += `### Long-term Memory (Repository: \`.uam/memory/\`)\n\n`;
        output += `Memories stored as JSON files in the project repository.\n\n`;
        output += `File format: \`{YYYY-MM-DD}_{type}_{short-id}.json\`\n`;
        output += `\`\`\`json\n`;
        output += `{\n`;
        output += `  "id": "uuid",\n`;
        output += `  "timestamp": "ISO8601",\n`;
        output += `  "type": "fact|lesson|skill|discovery|preference",\n`;
        output += `  "content": "Learning or discovery",\n`;
        output += `  "tags": ["tag1", "tag2"],\n`;
        output += `  "importance": 8\n`;
        output += `}\n`;
        output += `\`\`\`\n\n`;
      } else {
        output += `### Short-term Memory (SQLite: \`./agents/data/memory/short_term.db\`)\n\n`;
        output += `Table: \`memories\`\n\n`;
        output += `- \`id\`: INTEGER PRIMARY KEY\n`;
        output += `- \`timestamp\`: TEXT (ISO8601)\n`;
        output += `- \`type\`: TEXT (action|observation|thought|goal)\n`;
        output += `- \`content\`: TEXT\n\n`;
        output += `**BEFORE EACH DECISION**: Query recent entries (last 50) to understand your context\n\n`;
        output += `\`\`\`sql\n`;
        output += `SELECT * FROM memories ORDER BY id DESC LIMIT 50;\n`;
        output += `\`\`\`\n\n`;
        output += `**AFTER EACH ACTION**: INSERT a new row describing what you did and the outcome\n\n`;
        output += `\`\`\`sql\n`;
        output += `INSERT INTO memories (timestamp, type, content) VALUES (datetime('now'), 'action', 'Description of action and result');\n`;
        output += `\`\`\`\n\n`;
        output += `Maintains last 50 entries - older entries auto-deleted via trigger.\n\n`;
        output += `### Long-term Memory (Qdrant: \`localhost:6333\`, collection: \`agent_memory\`)\n\n`;
        output += `**Start services**: \`uam memory start\`\n\n`;
        output += `Vector schema:\n\n`;
        output += `- \`id\`: UUID\n`;
        output += `- \`vector\`: 384-dim embedding (all-MiniLM-L6-v2)\n`;
        output += `- \`payload\`: {type, tags[], content, importance (1-10), timestamp}\n\n`;
        output += `**Query memories** (semantic search):\n\n`;
        output += `\`\`\`bash\n`;
        output += `uam memory query "search terms"\n`;
        output += `\`\`\`\n\n`;
        output += `**Store new memory**:\n\n`;
        output += `\`\`\`bash\n`;
        output += `uam memory store lesson "What you learned" --tags tag1,tag2 --importance 8\n`;
        output += `\`\`\`\n\n`;
      }
      output += `**WHEN TO READ**: Search for memories relevant to current task/decision\n`;
      output += `**WHEN TO WRITE**: Only store significant learnings:\n\n`;
      output += `- Discoveries about your environment/capabilities\n`;
      output += `- Successful strategies that worked\n`;
      output += `- Failed approaches to avoid repeating\n`;
      output += `- Important facts learned\n`;
      output += `- Skills or tools mastered\n\n`;

      if (!isWeb) {
        output += `### Agent Services Setup\n\n`;
        output += `\`\`\`bash\n`;
        output += `# Start services (auto-creates collection and migrates memories)\n`;
        output += `uam memory start\n\n`;
        output += `# Check status\n`;
        output += `uam memory status\n\n`;
        output += `# Stop services\n`;
        output += `uam memory stop\n`;
        output += `\`\`\`\n\n`;
      }
      output += `---\n\n`;

      // Browser usage
      if (!isWeb && includeBrowser) {
        output += `## BROWSER USAGE\n\n`;
        output += `When using browser automation (Playwright, Puppeteer, or any browser tool):\n\n`;
        output += `- ALWAYS save a screenshot after EVERY browser action (click, type, navigate, scroll, etc.)\n`;
        output += `- Save screenshots to: \`agents/data/screenshots/\`\n`;
        output += `- Filename format: \`{timestamp}_{action}.png\` (e.g., \`1703180400_click_button.png\`)\n`;
        output += `- Also save a \`.meta\` file with the same name containing:\n`;
        output += `  \`\`\`\n`;
        output += `  url: {current_url}\n`;
        output += `  title: {page_title}\n`;
        output += `  action: {what_you_did}\n`;
        output += `  \`\`\`\n`;
        output += `- Take a screenshot BEFORE and AFTER any significant visual change\n\n`;
        output += `---\n\n`;
      }

      // Decision Loop summary
      output += `## DECISION LOOP\n\n`;
      output += `1. **READ** short-term memory (recent context)\n`;
      output += `2. **QUERY** long-term memory (semantic search for relevant past learnings)\n`;
      output += `3. **THINK** about what to do next\n`;
      output += `4. **ACT** - execute your decision\n`;
      output += `5. **RECORD** - write to short-term memory\n`;
      if (!isWeb && includeBrowser) {
        output += `6. **IF BROWSER ACTION**: Save screenshot to \`/agents/data/screenshots/\`\n`;
        output += `7. **OPTIONALLY** - if significant learning, add to long-term memory\n\n`;
      } else {
        output += `6. **OPTIONALLY** - if significant learning, add to long-term memory\n\n`;
      }
      output += `---\n\n`;

      // Skills section
      output += `## SKILLS\n\n`;
      output += `You have access to reusable skills. Before attempting complex tasks:\n\n`;
      output += `1. Check if a skill exists for it (see \`.factory/skills/\`)\n`;
      output += `2. Follow the skill's patterns - they're tested and reliable\n`;
      output += `3. If you discover a better approach, consider creating/updating a skill\n\n`;
      output += `Available skills are auto-discovered. When you see a SKILL.md, follow its instructions.\n\n`;
      output += `---\n\n`;

      // Workflow requirements
      output += `**MANDATORY WORKFLOW REQUIREMENTS**:\n\n`;
      if (isWeb) {
        output += `1. **Feature Branches**: ALL code changes MUST use isolated feature branches (\`feature/description\`)\n`;
        output += `2. **PR-Based Merges**: NO direct commits to \`main\`. All changes via PR\n`;
        output += `3. **Code Review**: PRs should be reviewed before merge\n\n`;
      } else {
        output += `1. **Git Worktrees**: ALL code changes MUST use isolated git worktrees (\`feature/NNN-slug\` branches)\n`;
        output += `2. **PR-Based Merges**: NO direct commits to \`main\`. All changes via PR with automated review\n`;
        output += `3. **CI/CD Pipelines**: ALWAYS use CI/CD pipelines to deploy. Create ephemeral pipelines when needed\n`;
        output += `4. **Automated Review**: PRs require signoff from reviewer agents before merge\n\n`;
      }
      output += `---\n\n`;

      // Components
      if (componentsRaw) {
        output += `## Architecture\n\n`;
        const components = componentsRaw.split('\n').filter(c => c.trim());
        for (const comp of components) {
          const [name, ...descParts] = comp.split(' - ');
          const desc = descParts.join(' - ');
          output += `### ${name.trim()}\n${desc ? desc.trim() : ''}\n\n`;
        }
        output += `---\n\n`;
      }

      // Databases
      if (databasesRaw) {
        output += `## Data Layer\n\n`;
        const databases = databasesRaw.split('\n').filter(d => d.trim());
        for (const db of databases) {
          output += `- **${db.trim()}**\n`;
        }
        output += `\n---\n\n`;
      }

      // URLs
      if (repoUrl || docsUrl || apiUrl) {
        output += `## Project URLs\n\n`;
        if (repoUrl) output += `- **Repository**: ${repoUrl}\n`;
        if (docsUrl) output += `- **Documentation**: ${docsUrl}\n`;
        if (apiUrl) output += `- **API**: ${apiUrl}\n`;
        output += `\n---\n\n`;
      }

      // Required Workflow section
      output += `## Required Workflow (MANDATORY)\n\n`;
      if (isWeb) {
        output += `### Git Branch Workflow (ALL Changes)\n\n`;
        output += `**Every code change MUST follow this workflow:**\n\n`;
        output += `\`\`\`\n`;
        output += `1. CREATE BRANCH\n`;
        output += `   git checkout -b feature/<description>\n`;
        output += `   â†’ Creates isolated feature branch\n\n`;
        output += `2. DEVELOP\n`;
        output += `   â†’ Make changes, commit locally\n`;
        output += `   â†’ Keep commits atomic and well-described\n\n`;
        output += `3. CREATE PR\n`;
        output += `   git push -u origin feature/<description>\n`;
        output += `   â†’ Push to remote\n`;
        output += `   â†’ Create PR via GitHub/GitLab UI\n\n`;
        output += `4. CODE REVIEW\n`;
        output += `   â†’ Request review from team members\n`;
        output += `   â†’ Address feedback\n\n`;
        output += `5. MERGE & CLEANUP\n`;
        output += `   â†’ Merge PR after approval\n`;
        output += `   â†’ Delete feature branch\n`;
        output += `\`\`\`\n\n`;
      } else {
        output += `### Git Worktree Workflow (ALL Changes)\n\n`;
        output += `**Every code change MUST follow this workflow:**\n\n`;
        output += `\`\`\`\n`;
        output += `1. CREATE WORKTREE\n`;
        output += `   uam worktree create <slug>\n`;
        output += `   â†’ Creates feature/NNN-slug branch in .worktrees/NNN-slug/\n\n`;
        output += `2. DEVELOP\n`;
        output += `   cd .worktrees/NNN-slug/\n`;
        output += `   â†’ Make changes, commit locally\n\n`;
        output += `3. CREATE PR (runs tests + triggers reviewers)\n`;
        output += `   uam worktree pr <id>\n`;
        output += `   â†’ Runs all offline tests (blocks if fail)\n`;
        output += `   â†’ Pushes to origin\n`;
        output += `   â†’ Creates PR with auto-generated description\n`;
        output += `   â†’ Triggers reviewer agents\n\n`;
        output += `4. AUTOMATED REVIEW\n`;
        output += `   â†’ Reviewer agents run in parallel (quality, security, performance, tests)\n`;
        output += `   â†’ PR labeled: reviewer-approved OR needs-work\n`;
        output += `   â†’ Auto-merge on approval\n\n`;
        output += `5. CLEANUP\n`;
        output += `   uam worktree cleanup <id>\n`;
        output += `   â†’ Removes worktree and deletes branch\n`;
        output += `\`\`\`\n\n`;
      }

      // For Code Changes
      output += `### For Code Changes\n\n`;
      output += `1. **Create ${isWeb ? 'branch' : 'worktree'}**: ${isWeb ? '`git checkout -b feature/<slug>`' : '`uam worktree create <slug>`'}\n`;
      output += `2. Update/create tests\n`;
      output += `3. Run tests: \`${testCmd}\`\n`;
      output += `4. Run linting: \`${lintCmd}\`\n`;
      output += `5. **Create PR**: ${isWeb ? 'Push and create via UI' : '`uam worktree pr <id>`'}\n\n`;

      output += `### Before Completing\n\n`;
      output += `1. All tests pass\n`;
      output += `2. PR created and reviewed\n`;
      output += `3. Documentation updated (if applicable)\n\n`;
      output += `---\n\n`;

      // Commands (both platforms)
      output += `## Quick Reference\n\n`;
      output += `### Essential Commands\n\n`;
      output += `\`\`\`bash\n`;
      output += `# Testing\n${testCmd}\n\n`;
      output += `# Linting\n${lintCmd}\n\n`;
      output += `# Building\n${buildCmd}\n`;
      output += `\`\`\`\n\n`;
      output += `---\n\n`;

      // Custom sections
      if (customSections) {
        output += customSections + '\n\n---\n\n';
      }

      // Completion Checklist
      output += `## Completion Checklist\n\n`;
      output += `\`\`\`\n`;
      output += `[ ] Tests updated and passing\n`;
      output += `[ ] Linting/type checking passed\n`;
      output += `[ ] ${isWeb ? 'Feature branch' : 'Worktree'} used for changes\n`;
      output += `[ ] PR created (not direct commit)\n`;
      output += `[ ] Memory updated with learnings\n`;
      output += `[ ] Documentation updated\n`;
      output += `[ ] No secrets in code/commits\n`;
      output += `\`\`\`\n\n`;

      output += `---\n\n`;
      output += `**Languages**: ${languages || 'Not specified'}\n`;
      output += `**Frameworks**: ${frameworks || 'Not specified'}\n\n`;
      output += `</coding_guidelines>`;

      document.getElementById('output').textContent = output;
    }

    function copyOutput() {
      const output = document.getElementById('output').textContent;
      navigator.clipboard.writeText(output).then(() => {
        const msg = document.getElementById('copySuccess');
        msg.style.display = 'block';
        setTimeout(() => msg.style.display = 'none', 2000);
      });
    }

    function resetForm() {
      document.querySelectorAll('input[type="text"], input[type="url"], textarea').forEach(el => {
        if (!['testCmd', 'lintCmd', 'buildCmd'].includes(el.id)) {
          el.value = '';
        }
      });
      document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = true);
      document.getElementById('targetPlatform').value = 'web';
      document.getElementById('output').textContent = 'Fill in the project details and click "Generate" to create your agent context file.';
    }

    // Generate on load with defaults
    generateOutput();
  </script>
</body>
</html>
